"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Youtube",{enumerable:!0,get:function(){return l}});const t=require("googleapis"),e=require("./googleAuth.js");function s(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const i=["channelId","publishedAt","title","description","thumbnail"];function a(t={},e=i,s="high"){let l={};for(let i of e)if("thumbnail"===i)try{l[i]=`=image("${t.thumbnails[s].url}")`}catch{l[i]=""}else i.endsWith("_ko")?l[i.slice(0,-2)]=t.localized[i.split("_")[0]]:l[i]=t[i];return l}class l{async init(){let e=await this.googleAuth.authorize();this.service=t.google.youtube({version:"v3",auth:e})}async search(t={}){let e=t.q||"gemini",s=t.order||"relevance",i=t.part||"snippet".split(","),a=t.maxResults||100;return(await this.service.search.list({q:e,order:s,part:i,maxResults:a})).data.items}async channelIdByCustomUrl(t){return t=t.startsWith("@")?t.substring(1):t,(await this.search({q:t}))[0].id.channelId}async subscriptions_(){let t;let e=[];do{let s=await this.service.subscriptions.list({part:"id,snippet".split(","),mine:!0,maxResults:50,pageToken:t||void 0});e.push(...s.data.items),t=s.data.nextPageToken||void 0}while(t)return e}async subscriptions(){let t=await this.subscriptions_(),e=[];for(let s of t){let t={id:s.id};Object.assign(t,a(s.snippet)),e.push(t)}return e}async channelInfo_(t){let e=(await this.service.channels.list({part:"snippet,contentDetails".split(","),id:t.split(","),maxResults:25})).data.items;return void 0==e||0==e.length?[]:e}async channelInfo(t,e="high"){let s=(await this.channelInfo_(t))[0],l=s.contentDetails.relatedPlaylists,n={channelId:t,likes:"",uploads:""};return Object.assign(n,a(s.snippet,["customUrl",...i.slice(1),"title_ko","description_ko"],e)),n.likes=l.likes,n.uploads=l.uploads,n}async channelInfoByCustomUrl(t,e="high"){return this.channelInfo(await this.channelIdByCustomUrl(t),e)}async channelPlaylists_(t){let e;let s=[];do{let i=await this.service.playlists.list({part:"snippet,contentDetails".split(","),channelId:t,maxResults:50,pageToken:e||void 0});s.push(...i.data.items),e=i.data.nextPageToken||void 0}while(e)return s}async channelPlaylists(t,e="high"){let s=[];for(let l of(await this.channelPlaylists_(t))){let t={playlistId:l.id,itemCount:0};Object.assign(t,a(l.snippet,i.concat(["title_ko","description_ko"]),e)),t.itemCount=l.contentDetails.itemCount,s.push(t)}return s}async channelPlaylistsByCustomUrl(t){return await this.channelPlaylists(await this.channelIdByCustomUrl(t))}async videosByPlaylist_(t){let e;let s=[];do{let i=await this.service.playlistItems.list({part:"snippet,contentDetails".split(","),playlistId:t,maxResults:50,pageToken:e||void 0});s.push(...i.data.items),e=i.data.nextPageToken||void 0}while(e)return s}async videosByPlaylist(t,e="high"){let s=[];for(let l of(await this.videosByPlaylist_(t))){let t={videoId:l.contentDetails.videoId};Object.assign(t,a(l.snippet,i,e)),s.push(t)}return s}async myPlaylists_(){let t;let e=[];do{let s=await this.service.playlists.list({part:"snippet,contentDetails".split(","),mine:!0,maxResults:50,pageToken:t||void 0});e.push(...s.data.items),t=s.data.nextPageToken||void 0}while(t)return e}async myPlaylists(t="high"){let e=[];for(let s of(await this.myPlaylists_())){let l={playlistId:s.id,itemCount:0};Object.assign(l,a(s.snippet,i.concat(["title_ko","description_ko"]),t)),l.itemCount=s.contentDetails.itemCount,e.push(l)}return e}async getWatchLaterPlaylistId(){try{let t=await this.service.channels.list({part:"contentDetails",mine:!0});if(t.data.items&&t.data.items.length>0)return t.data.items[0].contentDetails.relatedPlaylists.watchLater;return null}catch(t){return console.error("'나중에 볼 동영상' 플레이리스트 ID 가져오기 오류:",t),null}}async getWatchLaterVideos(t=50){let e=await this.getWatchLaterPlaylistId();if(!e)return console.error("'나중에 볼 동영상' 플레이리스트 ID를 가져올 수 없습니다."),[];try{return(await this.videosByPlaylist(e)).slice(0,t)}catch(t){return console.error("'나중에 볼 동영상' 가져오기 오류:",t),[]}}async getMyChannelId(){try{let t=await this.service.channels.list({part:"id,snippet".split(","),mine:!0});if(!t.data.items||!(t.data.items.length>0))return console.log("No channel found."),null;{let e=t.data.items[0].id;return console.log("Your channel ID is:",e),e}}catch(t){return console.error("Error fetching channel ID:",t),null}}async getRelatedPlaylists(){return(await this.service.channels.list({part:"contentDetails",mine:!0})).data.items[0].contentDetails.relatedPlaylists}async myPlaylistItems(t="LL"){let e;let s=[];do{let i=await this.service.playlistItems.list({part:"snippet,contentDetails",playlistId:t,maxResults:50,pageToken:e||void 0});s.push(...i.data.items),e=i.data.nextPageToken||void 0}while(e)return s}constructor({user:t="bigwhitekmc",type:i="oauth2",sn:a=0,scopeDir:l="",authDir:n=""}={}){s(this,"service",void 0),s(this,"googleAuth",void 0),this.googleAuth=new e.GoogleAuth({user:t,type:i,sn:a,scopeDir:l,authDir:n})}}